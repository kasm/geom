<html>
  <head>
    <style>
      #cont {
        display: flex;
      }
      canvas {
 
        border: 1px solid red;
      }
      #dashboard > div {
        margin: 5px;
      }
      textarea {
        contenteditable: true;
        border: 1px solid black;
        background-color: antiquewhite;
        width: 450px;
        height: 550px;
      }
    </style>
  </head>
<body>
  <div id="cont">
    <div id="canv"><canvas>
    </canvas></div>
    <div id="dashboard">
      <div>
        <textarea> 
        </textarea>
      </div>
      <div>
        <button id="apply">apply</button>
      </div>
        
      
    </div>
  </div>

</body>
<script src = "geom_core.js"></script>
<script>
    let gc = GeomCore();

  let width = 600
  let height = 600
  let canvas = document.querySelector('canvas')
  let div = document.querySelector('div')
  canvas.width=width
  canvas.height = height
  let ctx = canvas.getContext('2d')
  function conv(p) {
    if (p?.type) {
      return [
        p.x + width / 2,
        height / 2 - p.y
      ]
    }
    return [
      p[0] + width / 2,
      height / 2 - p[1] 
    ]
  }
  function drawAxis() {
    // ds([[-width, 0], [width, 0]])
    // ds([[0, -height], [0, height]])
    dli({a: 1, b:0, c:0})
    dli({a: 0, b:1, c:0})
  }
  drawAxis()

  function dp(p, color) {

    let r = 3

    if (p?.type === 'point') {
    //  console.log('draw point  type ')
      ctx.beginPath()
      ctx.fillStyle = color ?? p.color
      ctx.strokeStyle = color ?? p.color
      let c = conv(p)
      ctx.arc(c[0], c[1], r, 0, Math.PI*2)
      //ctx.arc(200,200, r, 0, Math.PI*2)
     // ctx.stroke()
      ctx.fill()
      return
    }
    let c = color ?? 'black'
    ctx.beginPath()
    ctx.fillStyle = c
    ctx.moveTo(conv(p[0]), (p[1]))
    ctx.lineTo(conv(p[0]+5), p[1])
    console.log('dp: ', conv(p))
    ctx.arc(conv(p)[0], conv(p)[1], r, 0, Math.PI*2)
    ctx.stroke()
    ctx.fill()
    // ctx.endPath()
  }
  function li(li, color) {
    let d = 5555
    let p0 = [
      li
    ]
  }

  function point(x, y, color) { return {type: 'point', x, y, color: color ?? 'black'}}

  function ds(seg1, color, width) {



    if (seg1?.type) {
      
    }
    console.warn('ds ', seg1, color, width)
    ctx.beginPath()
    ctx.strokeStyle = (color ?? seg1.color) ?? 'black'

    ctx.lineWidth= width ?? 3
    if (seg1?.type) {
      let p1 = conv(seg1.pts[0])

      ctx.moveTo(p1[0], p1[1])
      for (let i=1; i<seg1.pts.length; i++) {
        let p2 = conv(seg1.pts[i])

        ctx.lineTo(p2[0], p2[1])

      }
      
    } else {
      ctx.moveTo(conv(seg1[0])[0], conv(seg1[0])[1])
      ctx.lineTo(conv(seg1[1])[0], conv(seg1[1])[1])
    }
    ctx.stroke()
  }

  function d(ob, p2, p3) {
    if (Array.isArray(ob)) ob.forEach(e => d(e, p2, p3))
    if (ob?.type === 'line') dli(ob)
    if (ob?.type === 'point') dp(ob)
    if (ob?.type === 'seg') ds(ob, p2, p3)
  }

  function dli(line1, color) {
    ctx.beginPath()
    ctx.lineWidth=1
    let c = color ?? 'black'
    ctx.fillStyle = c
    ctx.strokeStyle = c
    let cen = gc.lineCenter(line1)
    console.log('cen ', cen)
    //cen.x = 22; 
    //cen.y = 33
    let r = 11
    let cen1 = point(cen.x + line1.a * r, cen.y +line1.b*r)
    let cenc = conv(cen)
    let cen1c = conv(cen1)

    let p1 = conv(gc.lineGetAbs(line1, {type: 'point', x: -800, y:0}))
    let p2 = conv(gc.lineGetAbs(line1, {type: 'point', x:  800, y:0}))
    console.log(p1, p2)
    ctx.moveTo(p1[0], p1[1])
    ctx.lineTo(p2[0], p2[1])
    ctx.stroke()
    ctx.beginPath()
    ctx.moveTo(cenc[0], cenc[1])
    ctx.lineTo(cen1c[0], cen1c[1])
    ctx.stroke()
  }
function dtr(tr, color) {
  ctx.beginPath()
  ctx.lineWidth = 1
  ctx.strokeStyle = color ?? 'blue'
  let p1 = conv(tr[0])
  let p2 = conv(tr[1])
  let p3 = conv(tr[2])
  ctx.moveTo(p1[0], p1[1])
  ctx.lineTo(p2[0], p2[1])
  ctx.lineTo(p3[0], p3[1])
  ctx.lineTo(p1[0], p1[1])
  ctx.stroke()
}
</script>



<script>
  let ta = document.querySelector('textarea')
  ta.innerHTML='kjkjk'
  // let p0 = [-100, 100]
  // let p1 = [-200, 100]
  // let line01 = []
  // ds([p0, p1])
  // line01 = gc.line_point_point(line01, p0, p1)
  // console.log('line 01', line01)
  // dp(p0, 'green')
  // dp(p1, 'red')


  let p = `
  ctx.clearRect(0, 0, canvas.width, canvas.height)
  drawAxis()

  let p0 = [-100, 100]
  let p1 = [-200, 100]
  let p21 = [-250, 152]
  let line01 = []
  let line21 = []
  ds([p0, p1])
  ds([p0, p21])
  line01 = gc.line_point_point(line01, p0, p1)
  line21 = gc.line_point_point(line21, p0, p21)
  let p22 = []
  p22 = gc.point_per_point_line(p22, p1, line21)
  console.log('line 01', line01)
  dp(p0, 'green')
  dp(p1, 'red')
  dp(p21, 'red')
  dp(p22, 'blue')
  ds([p1, p22])
  let e3 = {type: 'line', a: .8, b: .6, c: -3}
  // let e3 = {type: 'line', a: 1, b:0, c: -3}
console.log('cen ', gc.lineCenter(e3))
let p3 = {type: 'point', x: 2.4, y:1.98}
let p3r = gc.lineGetRel(e3, p3)
console.log('p3r ', p3r)
let p3a = gc.lineGetAbs(e3, p3r)
let p3a1 = gc.lineGetAbs(e3, {type: 'point', x: 10, y: 0})
let p3a2 = gc.lineGetAbs(e3, {type: 'point', x: -10, y: 0})
console.log('p3a ', p3a)
console.log('p3a1 ', p3a1)
console.log('p3a2 ', p3a2)

dli(e3)
  `

p = `
let p0 = point(-150, 200, 'green')
let p1 = point(-110, 120, 'green')
let p2 = point(55, 10)
let p3 = point(100, 110)
let lii = gc.line(p0, p1)
let li2 = gc.line(p1,p2)
let li3 = gc.line(p2,p3)
let p00 = point(0, 0)
let pp = gc.perPoint(lii, p00)
let ppar = gc.parPoint(lii, -55)
console.log(lii)
let p4 = point(50, 50)
let li4 = gc.perLine(lii, p4)
let lir = gc.line(p2, p3)
let lia = gc.absLine(lii, lir)
let lir2 = gc.relLine(lii, lia)
let p5 = gc.lineGetRel(lii, {x: 5, y:0})
lir2.c +=3
console.log(lir, lia)

//d([p0, p1, lii, pp, ppar, p4, li4, p2, p3, li2, li3])
d([p0, p1, lii, pp, ppar, p2, p3, lir, p5, lia, lir2])
`

p = `
ctx.clearRect(0, 0, canvas.width, canvas.height)
drawAxis()
let p0 = point(-150, 280, 'green')
let p1 = point(-110, 120, 'green')
let p2 = point(55, 150)
let p3 = point(85, 110)
let p4 = point(120, 125)
let p5 = point(150, 115)
let p6 = point(170, 145)
let pn = gc.shiftSeg(p0, p1, 11)
let s1 = gc.seg([p0, p1, p2, p3,p4,p5, p6])
s1.color = 'red'
d([p0, p1, p2, p3, pn[0], pn[1]])
d([s1])
let s2 = gc.shiftPline(s1, 0)
let s3 = gc.shiftPline(s1, 100)
d(s3,'red')
s2 =gc.filletPoly(s2, 132)
s3 =gc.filletPoly(s3, 142)

console.log('s2 ', s2)
d([s2, s3], null, 1)
let trs = gc.triangles(s2, s3)
console.log(trs)
trs.forEach(t => dtr(t))

// let li1 = gc.line(p1, p2)
// let li2 = gc.line(p2, p3)
// let pnts = gc.filletLines(li1, li2, 33, 33)
// let pnts2 = gc.filletSeg(p1, p2, p2, p3, 23)
// let sf = gc.seg(pnts2)
//d([sf])

// let sfn = gc.filletPoly(s1, 22)
// d(sfn)

`
  ta.value=p

  eval(p)
  document.getElementById('apply').addEventListener('click', () => {
    let t = ta.value
    console.log(t)
    eval(t)
  })
</script>

</html>
